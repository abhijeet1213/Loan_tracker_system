{% extends "layouts/base.html" %}

{% block title %} AKservices {% endblock %}
{% block stylesheets %}
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.1/dist/css/bootstrap.min.css" rel="stylesheet">
    <link
      rel="stylesheet"
      href="https://cdn.datatables.net/1.11.3/css/dataTables.bootstrap5.min.css"
      

          />
     

          1
          2
          3
              
          <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/1.13.1/css/jquery.dataTables.css">

<style>
    .swal-button{
    width: 100px ;
    }
    .custom-card-header {
        background: #fff;
        display: flex;
        line-height: 0;
    }
    .card-footer {
   
        background-color:  #fff;
   
    }
    @import "compass/css3";

body{
  padding: 0px;
}
table, th, td {
  border: 1px solid rgb(231, 234, 236);
}
</style>
<style media="screen">
    .loading {
        position: fixed;
        z-index: 99;
        top: 0;
        left: 0;
        
        display: flex;
        justify-content: center;
        align-items: center;
        background: #222;
        text-align: center;
        width: 100%;
        height:100%;
        opacity: .5;
    }
        /* border: 16px solid #f3f3f3;
        border-radius: 50%;
        border-top: 16px solid #3498db;
        width: 110px;
        height: 110px;
        -webkit-animation: spin 2s linear infinite; /* Safari */
        /* animation: spin 2s linear infinite; *
        
       
      }
  
  
  /*
   * Loading Dots
   * Can we use pseudo elements here instead :after?
   */
  .loading span {
    display: inline-block;
    vertical-align: middle;
    width: 3em;
    height: 3em;
    margin: .19em;
    background: #007DB6;
    border-radius: 1em;
    animation: loading 1s infinite alternate;
  }
  
  /*
   * Dots Colors
   * Smarter targeting vs nth-of-type?
   */
  .loading span:nth-of-type(2) {
    background: #2f6ae9;
    animation-delay: 0.2s;
  }
  .loading span:nth-of-type(3) {
    background: #034bbf;
    animation-delay: 0.4s;
  }
  .loading span:nth-of-type(4) {
    background: #385ec9;
    animation-delay: 0.6s;
  }
  .loading span:nth-of-type(5) {
    background: #008bb2;
    animation-delay: 0.8s;
  }
  .loading span:nth-of-type(6) {
    background: #0b68a6;
    animation-delay: 1.0s;
  }
  .loading span:nth-of-type(7) {
    background: #1e6db6;
    animation-delay: 1.2s;
  }
  
  /*
   * Animation keyframes
   * Use transition opacity instead of keyframes?
   */
  @keyframes loading {
    0% {
      opacity: 0;
    }
    100% {
      opacity: 1;
    }
  }
  </style>
{% endblock stylesheets %}
{% block content %}

<div class="loading" style="display:none" id="loading">



    <span></span>
    <span></span>
    <span></span>
    <span></span>
    <span></span>
    <span></span>
    <span></span>

</div>

<div class="main-content">
    <div class="page-content">
        <div class="container-fluid">

            <div class="card">
                <div class="card-header text-black" style="background-color: #1a7dd4;">
                    <h5 style="color: azure" card-title>Reset Password</h5>
                </div>
                <div class="card-body">
                    {% csrf_token %}
                    <form action="#" method="POST">

                        <div class="card">
               
                            <div class="card-body">
                                <div class="row">
                                    
                                   
                                    <div class="mb-3 col-md-4">
                                        <label for="inputdate">New Password</label>
                                        <input type="password" class="form-control" id="new_pass" name="new_pass" required>
            
                                    </div>
            
                                    <div class="mb-3 col-md-4">
                                        <label for="inputdate">Confirm Password</label>
                                        <input type="password" class="form-control" id="conf_pass" name="conf_pass" required>
            
                                    </div>
                                </div>
                                <div class="card-footer">
                                
                                    <button style="float: right;" type="button" id="rstbtn" class="btn btn-primary" onclick="reset_pass()">Reset</button>
                                </div>    
            
                            </div>
                        </div>

                    </form>



                </div>
                <!-- <div class="card-footer"> -->
                    
                    <!-- <button style="float: right;" type="button" id="submitbtn" class="btn btn-primary" onclick="submit_new_record();this.disabled = true;">Submit</button> -->
                    
                    <!-- <button style="float: left;" type="button" onclick="reset()" class="btn btn-primary">Reset Password</button> -->
                <!-- </div> -->
            </div>

        </div>
      
    </div>

</div>




</div>

{% endblock content %}

{% block javascripts %}


<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.10.1/jquery.min.js"> </script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js"
    integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM"
    crossorigin="anonymous">
</script>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js" type="text/javascript"></script>
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

<script type="text/javascript" charset="utf8" src="https://cdn.datatables.net/1.13.1/js/jquery.dataTables.js"></script>
<script>
     
    $(document).ready(function () {
  $('#queue_data').DataTable({
      scrollX: false,
      
     
  });
  $(document).ready( function () {
        $('#queue_data').DataTable();
} );
});


// function reset(){
//     $('#reset_pass').show();
// }
</script>
<script>
    
function action(f_name,l_name,email,role,status){
    console.log(role,status)
    $('#first_name').val(f_name);
    $('#last_name').val(l_name);
    $('#e_mail').val(email);
    document.getElementById('e_mail').setAttribute("disabled","disabled");

    if (role=='False'){
        $("#role_type").val('1');

    }
    else{
        $("#role_type").val('2');

    }
    if (status=='True' ){
    $("#t_status ").val('1');
        
    }
    else{
    $("#t_status").val('2');

    }
    $("#submitbtn").text('Update');
    
  
}

function reset_pass(){
    
    // var new_username=$('#new_username').val();

    var new_pass=$('#new_pass').val();
  var conf_pass=$('#conf_pass').val();
//   if (!new_username || new_username ==''){
//     Swal.fire({
//             title: 'Please Enter The Username',
//             icon: "warning",
//             showDenyButton: false,
//             showCancelButton: false,
//             confirmButtonText: 'Yes',
//             denyButtonText: `No `,
//         })
//   }
  if (!new_pass || new_pass ==''){
    Swal.fire({
            title: 'Please Enter The New Password',
            icon: "warning",
            showDenyButton: false,
            showCancelButton: false,
            confirmButtonText: 'Yes',
            denyButtonText: `No `,
        })
  }

  else if (!conf_pass || conf_pass ==''){
    Swal.fire({
            title: 'Please Enter The Confirm Password',
            icon: "warning",
            showDenyButton: false,
            showCancelButton: false,
            confirmButtonText: 'Yes',
            denyButtonText: `No `,
        })
  }
  else if (conf_pass != new_pass){
    Swal.fire({
            title: 'Password Not Matching',
            icon: "warning",
            showDenyButton: false,
            showCancelButton: false,
            confirmButtonText: 'Yes',
            denyButtonText: `No `,
        })
  }
  else{
    $.ajax
                    (
                        {                       // initialize an AJAX request
                            method: "POST",
                            url: "/reset_pass",
                            contentType:"application/json",
                            dataType:'text',
                            data: JSON.stringify({
                              'pass':new_pass,
                                

                            }),

                            success: function (response) {
                                Swal.fire('Saved!', response, 'success')    
                                    Swal.fire({
                                        
                                        icon: 'success',
                                        title: "Password Updated successfully",
                                        text:''+ response,
                                        showConfirmButton: true,
                                       
                                    }).then(function () {
                                    $('#reset_pass').hide();

                                        location.reload();
                                    });
                              
                            }


                        }
                    );
  }
}
function submit_new_record() {
  var first_name=$('#first_name').val();
  var last_name=$('#last_name').val();
  var e_mail=$('#e_mail').val();
  var role_type=$("#role_type option:selected").val();
  var t_status=$("#t_status option:selected").val();
  console.log($("#submitbtn").text());

if($("#submitbtn").text()=='Update'){
    Swal.fire({
            title: 'Do you want to Update the record?',
            icon: "warning",
            showDenyButton: true,
            showCancelButton: false,
            confirmButtonText: 'Yes',
            denyButtonText: `No `,
        }).then((result) => {
            /* Read more about isConfirmed, isDenied below */
            if (result.isConfirmed) {
                $("#submitbtn").text('Submit');
                document.getElementById('submitbtn').setAttribute("disabled","disabled");
                $('#loading').show();
                $.ajax
                    (
                        {                       // initialize an AJAX request
                            method: "POST",
                            url: "/updateuser",
                            contentType:"application/json",
                            dataType:'text',
                            data: JSON.stringify({
                              'first_name':first_name,
                                'last_name': last_name,
                                'e_mail': e_mail,
                                'role_type': role_type,
                                't_status': t_status,
                                
                               
                               



                            }),

                            success: function (response) {
                                Swal.fire('Saved!', response, 'success')    
                                    Swal.fire({
                                        
                                        icon: 'success',
                                        title: "Account has been Updated successfully",
                                        text: 'Password : ' + response,
                                        showConfirmButton: true,
                                       
                                    }).then(function () {
                                        location.reload();
                                    });
                              
                            }


                        }
                    );

            } else if (result.isDenied) {
                $('#loading').hide();
                document.getElementById('submitbtn').removeAttribute("disabled");

                Swal.fire('Changes are not saved', '', 'info')
            }
        })

}
 else{ Swal.fire({
            title: 'Do you want to Submit the record?',
            icon: "warning",
            showDenyButton: true,
            showCancelButton: false,
            confirmButtonText: 'Yes',
            denyButtonText: `No `,
        }).then((result) => {
            /* Read more about isConfirmed, isDenied below */
            if (result.isConfirmed) {
                
                document.getElementById('submitbtn').setAttribute("disabled","disabled");
                $('#loading').show();
                $.ajax
                    (
                        {                       // initialize an AJAX request
                            method: "POST",
                            url: "/newuser",
                            contentType:"application/json",
                            dataType:'text',
                            data: JSON.stringify({
                              'first_name':first_name,
                                'last_name': last_name,
                                'e_mail': e_mail,
                                'role_type': role_type,
                                't_status': t_status,
                                
                               
                               



                            }),

                            success: function (response) {
                                Swal.fire('Saved!', response, 'success')    
                                    Swal.fire({
                                        
                                        icon: 'success',
                                        title: "Account has been created successfully",
                                        text: 'Password : ' + response,
                                        showConfirmButton: true,
                                       
                                    }).then(function () {
                                        location.reload();
                                    });
                              
                            }


                        }
                    );

            } else if (result.isDenied) {
                $('#loading').hide();
                document.getElementById('submitbtn').removeAttribute("disabled");

                Swal.fire('Changes are not saved', '', 'info')
            }
        })

    }

}


</script>

{% endblock javascripts %}